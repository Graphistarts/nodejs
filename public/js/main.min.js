$(document).ready(function(){function t(t){return"<strong>"+t+"</strong>"}function n(n,e){var o=((new Date).getTime(),n.length),r=e.length,s={},i="",c="",a=[],l=[],p=[],d=0,f=0,h=0,m=0;if(0==o)return 0;if(0==r)return-1;o>r?(l=n,a=e):(l=e,a=n);for(var u=a.length;u>=0;u--)p[u]=[u];for(var $=l.length;$>=0;$--)p[0][$]=$;for(u=1;u<=a.length;u++){for($=1;$<=l.length;$++)a[u-1]==l[$-1]?p[u][$]=p[u-1][$-1]:p[u][$]=Math.min(p[u-1][$-1],Math.min(p[u][$-1],p[u-1][$]))+1,u==f+1&&$==d+1&&(h=d,m=f,p[f][d]!=p[f][d+1]||p[f+1][d+1]==p[f][d+1]&&p[f+1][d+1]==p[f+1][d]?(f=u,d=$,p[f][d]>p[m][h]&&(a[d-1]=t(a[d-1]))):d+=(p[f][d]==p[f][d+1],1));p[f][d]>p[m][h]&&(l[d-1]=t(l[d-1]))}for(var v=d;v<=l.length;v++)p[a.length][v-1]<p[a.length][v]&&(l[v-1]=t(l[v-1]));for(var g=0;g<l.length;g++)c+=l[g]+" ";for(var y=0;y<a.length;y++)i+=a[y]+" ";return n.length>e.length?(s.corrWord1=c,s.corrWord2=i):(s.corrWord1=i,s.corrWord2=c),s}var e=io(),o=$(".dd-profile");o.on("click",function(t){$(".dd-profile .dd").toggleClass("show"),o.is(t.target)||0!==o.has(t.target).length||$(".dd-profile .dd").removeClass("show")}),$(".disconnect").on("click",function(){e.emit("forceDisconnect")}),$.ajax({url:"/api/get-images",data:"",processData:!1,contentType:!1,type:"GET",success:function(t){var n=t;$("body .heart").find("span").html(n.heart),$("body .comment").find("span").html(n.comment),$("body .correct").find("span").html(n.correct)},error:function(t){alert(t)}}),$("body .heart").on("click",function(){var t=$(this).find("span"),n=$(this).find("strong"),e=!0,o=$(this).parents(".post-container").attr("id");t.toggleClass("on"),t.hasClass("on")?(e=!0,n.html(parseInt(n.html())+1)):(e=!1,n.html(parseInt(n.html())-1)),$.ajax({url:"/add-like",type:"post",data:{operator:e,id_post:o},success:function(t){console.log(t)}})}),$(".reaction-post .comment").on("click",function(t){$(this).parents(".post-container").find(".comment-container").toggleClass("active"),$(this).parents(".post-container").find(".correction-container").removeClass("active")}),$(".reaction-post .correct").on("click",function(t){$(this).parents(".post-container").find(".correction-container").toggleClass("active"),$(this).parents(".post-container").find(".comment-container").removeClass("active")}),$(".actions .cancel").on("click",function(t){$(this).parents(".user-correction-post").find(".activator").addClass("active"),$(this).parents(".corrector").removeClass("active")}),$.ajax({url:"/api/session",type:"get",success:function(t){$(".user-comment-post textarea").focus(function(n){var e="";$(this).on("keydown",function(n){if("13"==n.keyCode&&!n.shiftKey){var o=$(this).parents(".post-container"),r=o.attr("id");e='<li> <a href="/profile/'+t.username+'"><img src="/'+t.profile_picture+'" alt="profile picture of '+t.username+'"/></a> <div class="user-comment"> <div class="comment-infos clearfix"> <a href="">'+t.username+'</a> <span class="timer">a few seconds ago</span> </div> <p>'+$(this).val()+"</p> </div> </li>",$(this).parents(".comment-container").find(".comments-summary ul").prepend(e);var s=$(this).val();return $.ajax({url:"/add-comment",type:"post",data:{id_post:r,id_user:t.userID,content:s},success:function(t){o.find(".comment strong").html(parseInt(o.find(".comment strong").html())+1)}}),$(this).val(""),!1}})}),$(".actions .save").on("click",function(e){var o=$(this).parents(".post-container"),r=o.find(".corrector textarea").val().split(" "),s=o.find(".post .content-post p").text().split(" "),i=n(s,r),c=$(this).parents(".post-container"),a=c.attr("id"),l="<li> <a href='/profile/"+t.username+"'><img src='/"+t.profile_picture+"' alt=''/></a> <div class='user-correction'> <div class='correction-infos clearfix'> <a href='/profile/"+t.username+"'>"+t.username+"</a> <span class='timer'>a few seconds ago</span> </div> <div class='correction'> <p class='text'>"+i.corrWord1+"</p> <p class='text-correction'>"+i.corrWord2+"</p></div> </div></li>";o.find(".corrections-summary ul").prepend(l),$.ajax({url:"/add-correction",type:"post",data:{id_post:a,id_user:t.userID,content:i.corrWord1,correction:i.corrWord2},success:function(t){c.find(".correct strong").html(parseInt(c.find(".correct strong").html())+1)}}),$(this).parents(".actions").find(".cancel").trigger("click")}),$("#file_post").on("change",function(t){$(".name-file").text($(this).val().split("\\").pop())})}}),$("body").on("click",".more-options",function(t){$(this).parents(".options").find(".more-options-dd").toggleClass("active")}),$(".activator").on("click",function(t){$(this).removeClass("active"),$(this).parents(".user-correction-post").find(".corrector").addClass("active")}),$(".corrector textarea").each(function(t){var n=$(this).parents(".post-container").find(".content-post p").text();$(this).text(n)})});